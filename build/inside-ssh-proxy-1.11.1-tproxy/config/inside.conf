# Inside SSH Proxy - Standalone Configuration
# All-in-one config file for Tailscale exit gateway deployment

# ============================================================
# SSH PROXY SETTINGS
# ============================================================

[proxy]
# NAT mode - traditional jumphost with IP pool
nat_enabled = false
nat_host = 0.0.0.0
nat_port = 22

# TPROXY mode - transparent proxy (extracts SO_ORIGINAL_DST)
# Use this for Tailscale/VPN gateway transparent interception
tproxy_enabled = true
tproxy_host = 0.0.0.0
tproxy_port = 8022

# ============================================================
# TOWER API CONNECTION
# ============================================================

[tower]
# Tower API URL
# All-in-one deployment: http://localhost:5000
# Distributed deployment: https://tower.company.com
url = http://localhost:5000

# Gate authentication token (from Tower dashboard: Gates â†’ API Token)
token = your-gate-api-token-here

# Verify SSL certificate (set to false for self-signed certs in dev)
verify_ssl = true

# ============================================================
# GATE IDENTIFICATION
# ============================================================

[gate]
# Gate name (must match Tower database)
name = tailscale-exit-gateway

# Gate hostname
hostname = tailscale-gateway.company.com

# Location description
location = Tailscale Exit Node

# Gate version
version = 1.9.0

# ============================================================
# CACHE & OFFLINE MODE
# ============================================================

# Cache settings (improves performance, reduces Tower API load)
cache_enabled = true
cache_ttl = 30
cache_path = /var/lib/inside-gate/cache.db

# Offline mode (use cache when Tower unreachable)
offline_mode_enabled = true
offline_cache_duration = 300

# ============================================================
# HEARTBEAT & API CLIENT
# ============================================================

[heartbeat]
# Heartbeat interval (seconds) - report stays/sessions to Tower
interval = 30
timeout = 10

[api]
# API client settings
timeout = 10
retry_attempts = 3
retry_backoff = 2.0

# ============================================================
# LOGGING
# ============================================================

[logging]
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Recommended: WARNING for production (reduces log spam)
#              INFO for development/troubleshooting
#              DEBUG for detailed debugging
level = INFO

# Log file path
file = /var/log/inside/ssh_proxy.log

# Log rotation
max_size = 10485760
backup_count = 5

# ============================================================
# ADVANCED SETTINGS
# ============================================================

[advanced]
# Session recording (if enabled in Tower)
recording_path = /var/lib/inside-gate/recordings

# SSH host key (generated automatically if missing)
host_key_path = /var/lib/inside-gate/ssh_host_key

# Max concurrent sessions per gate
max_sessions = 1000

# Session timeout (seconds, 0 = no timeout)
session_timeout = 0
